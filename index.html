<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>BI Dashboard ‚Äì Ejecutivo & H√≠brido</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #003366;
            --accent: #007bff;
            --bg: #f0f2f5;
            --card-bg: #ffffff;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* ===== HEADER ===== */
        header {
            background: var(--primary);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        header h1 { font-size: 1.4rem; margin: 0; }

        select#fechaSelect {
            background: white;
            padding: 8px 15px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
        }

        /* ===== CONTENIDO PRINCIPAL ===== */
        main {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .view {
            display: none;
            height: 100%;
            width: 100%;
            overflow-y: auto;
        }

        .view.active { display: block; }

        /* ===== MAPA (Ocupa todo el espacio) ===== */
        #mapaFrame {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ===== SECCI√ìN RESUMEN (GRID DIN√ÅMICO) ===== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .kpis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            border-bottom: 4px solid var(--accent);
        }

        .kpi-card h2 { margin: 10px 0; font-size: 2rem; color: var(--primary); }

        /* Gr√°ficos en paralelo en PC, uno arriba de otro en M√≥vil */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        /* ===== NAVEGACI√ìN ===== */
        .nav-bar {
            background: white;
            display: flex;
            justify-content: center;
            border-top: 1px solid #ddd;
            padding: 10px 0;
        }

        .nav-btn {
            padding: 10px 40px;
            cursor: pointer;
            border-radius: 20px;
            margin: 0 10px;
            font-weight: 600;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn.active {
            background: var(--accent);
            color: white;
        }

        /* ===== RESPONSIVE (CELULARES) ===== */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr; /* Una columna en m√≥vil */
            }
            .nav-btn {
                padding: 10px 20px;
                flex: 1;
                font-size: 0.9rem;
            }
            .kpis-grid {
                grid-template-columns: 1fr 1fr; /* Dos columnas de KPIs */
            }
            header h1 { font-size: 1rem; }
        }
    </style>
</head>
<body>

<header>
    <h1>üìä DashCom v2.0</h1>
    <div>
        <select id="fechaSelect" onchange="cambiarFecha(this.value)">
            <option value="">Seleccionar Fecha</option>
            <option value="2025-10-31">31/10/2025</option>
            <option value="2025-11-30">30/11/2025</option>
            <option value="2025-12-31">31/12/2025</option>
            <option value="2026-01-19">19/01/2026</option>
        </select>
    </div>
</header>

<main>
    <div id="v-mapa" class="view active">
        <iframe id="mapaFrame" src=""></iframe>
    </div>

    <div id="v-resumen" class="view">
        <div class="container">
            <div class="kpis-grid">
                <div class="kpi-card">
                    <span>VENTAS TOTALES</span>
                    <h2 id="k-ventas">0</h2>
                </div>
                <div class="kpi-card">
                    <span>NODOS ACTIVOS</span>
                    <h2 id="k-nodos">0</h2>
                </div>
                <div class="kpi-card">
                    <span>ZONAS SIN VENTA</span>
                    <h2 id="k-sin">0</h2>
                </div>
                <div class="kpi-card">
                    <span>CUMPLIMIENTO</span>
                    <h2 id="k-pct">0%</h2>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Ventas por Zona Comercial</h3>
                    <canvas id="chartBar"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Distribuci√≥n de Presencia</h3>
                    <canvas id="chartPie"></canvas>
                </div>
            </div>
        </div>
    </div>
</main>

<nav class="nav-bar">
    <div class="nav-btn active" onclick="showV('v-mapa', this)">üìç Mapa</div>
    <div class="nav-btn" onclick="showV('v-resumen', this)">üìä Resumen</div>
</nav>

<script>
let bChart, pChart;

function showV(id, btn) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
}

function cambiarFecha(f) {
    if(!f) return;
    document.getElementById("mapaFrame").src = `mapas/mapa_${f}.html`;
    
    fetch(`mapas/kpis_${f}.json`)
        .then(r => r.json())
        .then(data => {
            renderDash(data);
        });
}

function renderDash(data) {
    // Actualizar N√∫meros
    document.getElementById("k-ventas").innerText = data.ventas_totales.toLocaleString();
    document.getElementById("k-nodos").innerText = data.nodos_con_ventas;
    document.getElementById("k-sin").innerText = data.zonas_sin_ventas;
    // ===== KPI CUMPLIMIENTO CORRECTO =====
    let pct = ((data.nodos_con_ventas / data.nodos_totales) * 100).toFixed(1);
    document.getElementById("k-pct").innerText = pct + "%";

    // Gr√°fico de Barras
    const ctxB = document.getElementById('chartBar').getContext('2d');
    if(bChart) bChart.destroy();
    bChart = new Chart(ctxB, {
        type: 'bar',
        data: {
            labels: ['Norte', 'Centro', 'Sur', 'Este', 'Chaco'],
            datasets: [{
                label: 'Ventas',
                data: [data.ventas_totales*0.3, data.ventas_totales*0.4, data.ventas_totales*0.1, data.ventas_totales*0.15, data.ventas_totales*0.05],
                backgroundColor: '#007bff'
            }]
        },
        options: { responsive: true }
    });

// Gr√°fico de Torta - An√°lisis de Cobertura de Ventas
const ctxP = document.getElementById('chartPie').getContext('2d');
if(pChart) pChart.destroy();

// L√ìGICA CORRECTA: 
// Usamos el total de NODOS para ver la efectividad real en el mapa
const nodosTotales = data.nodos_totales || (data.nodos_con_ventas + data.zonas_sin_ventas); // Asegurar que sumen el universo total
const nodosSinVenta = data.nodos_sin_ventas || 0; 

pChart = new Chart(ctxP, {
    type: 'doughnut',
    data: {
        labels: ['Nodos con Venta', 'Nodos sin Venta'],
        datasets: [{
            data: [data.nodos_con_ventas, nodosSinVenta],
            backgroundColor: ['#28a745', '#dc3545'], // Verde y Rojo Ejecutivo
            borderWidth: 2,
            hoverOffset: 10
        }]
    },
    options: { 
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom', // Mejor para notebooks y m√≥viles
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        let total = context.dataset.data[0] + context.dataset.data[1];
                        let percentage = ((context.raw / total) * 100).toFixed(1);
                        return `${context.label}: ${context.raw} (${percentage}%)`;
                    }
                }
            }
        }
    }
});
}
</script>

</body>
</html>


