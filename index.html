<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>BI Dashboard ‚Äì Ejecutivo & H√≠brido</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #003366;
            --accent: #007bff;
            --bg: #f0f2f5;
            --card-bg: #ffffff;
            --nav-height: 65px;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== HEADER ===== */
        header {
            background: var(--primary);
            color: white;
            padding: 0.8rem 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        header h1 { font-size: 1.1rem; margin: 0; }

        select#fechaSelect {
            background: white;
            padding: 6px 10px;
            border-radius: 6px;
            border: none;
            font-weight: bold;
        }

        /* ===== CONTENIDO PRINCIPAL ===== */
        main {
            flex: 1;
            overflow-y: auto;
            position: relative;
        }

        .view {
            display: none;
            height: 100%;
        }

        .view.active { display: block; }

        #mapaFrame {
            width: 100%;
            height: calc(100vh - 120px); 
            border: none;
            display: block;
        }

        /* ===== SECCI√ìN RESUMEN ===== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
            padding-bottom: 80px; /* Espacio para nav m√≥vil */
        }

        .kpis-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .kpi-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            text-align: center;
            border-bottom: 3px solid var(--accent);
        }

        .kpi-card span { font-size: 0.7rem; color: #666; font-weight: bold; display: block; }
        .kpi-card h2 { margin: 5px 0 0; font-size: 1.4rem; color: var(--primary); }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .chart-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        /* ===== NAVEGACI√ìN INFERIOR ===== */
        .nav-bar {
            position: fixed;
            bottom: 0; width: 100%; height: var(--nav-height);
            background: white;
            display: flex;
            border-top: 1px solid #ddd;
            z-index: 2000;
        }

        .nav-btn {
            flex: 1; border: none; background: none; color: #777;
            font-weight: 600; font-size: 0.85rem; cursor: pointer;
        }

        .nav-btn.active {
            color: var(--accent);
            background: #f0f7ff;
            border-top: 3px solid var(--accent);
        }

        @media (min-width: 768px) {
            .kpis-grid { grid-template-columns: repeat(4, 1fr); }
            .charts-grid { grid-template-columns: 1fr 1fr; }
            .nav-bar { position: static; height: 50px; border: none; justify-content: center; }
            .nav-btn { flex: none; width: 200px; }
            #mapaFrame { height: calc(100vh - 130px); }
        }
    </style>
</head>
<body>

<header>
    <h1>üìä DashCom v2.0</h1>
    <select id="fechaSelect" onchange="cambiarFecha(this.value)">
        <option value="">Seleccionar Fecha</option>
        <option value="2025-10-31">31/10/2025</option>
        <option value="2025-11-30">30/11/2025</option>
        <option value="2025-12-31">31/12/2025</option>
        <option value="2026-01-19">19/01/2026</option>
    </select>
</header>

<main>
    <div id="v-mapa" class="view active">
        <iframe id="mapaFrame" src=""></iframe>
    </div>

    <div id="v-resumen" class="view">
        <div class="container">
            <div class="kpis-grid" id="kpiContainer">
                <div class="kpi-card"><span>VENTAS TOTALES</span><h2 id="k-ventas">0</h2></div>
                <div class="kpi-card"><span>NODOS ACTIVOS</span><h2 id="k-nodos">0</h2></div>
                <div class="kpi-card"><span>SIN VENTA</span><h2 id="k-sin">0</h2></div>
                <div class="kpi-card"><span>COBERTURA</span><h2 id="k-pct">0%</h2></div>
            </div>
            <div class="charts-grid">
                <div class="chart-card"><h3>Ventas por Zona</h3><canvas id="chartBar"></canvas></div>
                <div class="chart-card"><h3>Distribuci√≥n Nodos</h3><canvas id="chartPie"></canvas></div>
            </div>
        </div>
    </div>
</main>

<nav class="nav-bar">
    <button class="nav-btn active" onclick="showV('v-mapa', this)">üìç Mapa</button>
    <button class="nav-btn" onclick="showV('v-resumen', this)">üìä Resumen</button>
</nav>

<script>
    let bChart, pChart;

    // 1. FUNCI√ìN PARA MOSTRAR VISTAS
    function showV(id, btn) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    }

    // 2. FUNCI√ìN PARA CARGAR DATOS (EL MOTOR)
    function cambiarFecha(f) {
        if(!f) return;
        
        // Carga el mapa en el iframe
        // IMPORTANTE: Aseg√∫rate que la carpeta 'mapas' est√© al mismo nivel que este archivo
        document.getElementById("mapaFrame").src = `mapas/mapa_${f}.html`;
        
        // Carga los KPIs del JSON
        fetch(`mapas/kpis_${f}.json`)
            .then(r => {
                if (!r.ok) throw new Error("Archivo JSON no encontrado");
                return r.json();
            })
            .then(data => {
                renderDash(data);
            })
            .catch(err => console.error("Error cargando datos:", err));
    }

    // 3. FUNCI√ìN PARA RENDERIZAR GR√ÅFICOS Y N√öMEROS
    function renderDash(data) {
        // Actualizar KPIs
        document.getElementById("k-ventas").innerText = data.ventas_totales.toLocaleString();
        document.getElementById("k-nodos").innerText = data.nodos_con_ventas;
        document.getElementById("k-sin").innerText = data.nodos_sin_ventas || 0;
        
        let total = data.nodos_con_ventas + (data.nodos_sin_ventas || 0);
        let pct = total > 0 ? ((data.nodos_con_ventas / total) * 100).toFixed(1) : 0;
        document.getElementById("k-pct").innerText = pct + "%";

        // Gr√°fico de Barras
        const ctxB = document.getElementById('chartBar').getContext('2d');
        if(bChart) bChart.destroy();
        bChart = new Chart(ctxB, {
            type: 'bar',
            data: {
                labels: Object.keys(data.ventas_por_zona || {}),
                datasets: [{
                    label: 'Ventas',
                    data: Object.values(data.ventas_por_zona || {}),
                    backgroundColor: '#007bff'
                }]
            },
            options: { responsive: true }
        });

        // Gr√°fico de Torta
        const ctxP = document.getElementById('chartPie').getContext('2d');
        if(pChart) pChart.destroy();
        pChart = new Chart(ctxP, {
            type: 'doughnut',
            data: {
                labels: ['Con Venta', 'Sin Venta'],
                datasets: [{
                    data: [data.nodos_con_ventas, data.nodos_sin_ventas || 0],
                    backgroundColor: ['#28a745', '#dc3545']
                }]
            },
            options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
        });
    }
</script>
</body>
</html>


